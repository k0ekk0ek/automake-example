WESTMERE = @HAVE_WESTMERE@
HASWELL = @HAVE_HASWELL@

SOURCES = src/parser.c
OBJECTS = $(SOURCES:.c=.o)
DEPENDS = $(SOURCES:.c=.o)

WESTMERE_SOURCES = src/westmere/parser.c
WESTMERE_OBJECTS = $(WESTMERE_SOURCES:.c=.o)

HASWELL_SOURCES = src/haswell/parser.c
HASWELL_OBJECTS = $(HASWELL_SOURCES:.c=.o)

# https://make.mad-scientist.net/papers/advanced-auto-dependency-generation/
# https://stackoverflow.com/questions/8025766/makefile-auto-dependency-generation

# https://www.cs.odu.edu/~zeil/cs350/latest/Public/make/index.html#dependency-analysis

# http://www.microhowto.info/howto/automatically_generate_makefile_dependencies.html

.PHONY: all clean

all: $(OBJECTS) $($(WESTMERE)_OBJECTS) $($(HASWELL)_OBJECTS)
	@echo "Target: $@"
	@echo "Prerequisites: $(OBJECTS) $($(WESTMERE)_OBJECTS) $($(HASWELL)_OBJECTS)"

clean:
	@rm -f $(OBJECTS)
	@rm -f $(WESTMERE_OBJECTS)
	@rm -f $(HASWELL_OBJECTS)

$(OBJECTS): $(SOURCES)
	@echo "Compiling $@"

$(WESTMERE_OBJECTS): $(WESTMERE_SOURCES)
	@echo "Compiling $@ (westmere specific)"

$(HASWELL_OBJECTS): $(HASWELL_SOURCES)
	@echo "Compiling $@ (haswell specific)"
